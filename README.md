# ESP32 ç©ºè°ƒæ§åˆ¶å™¨

åŸºäº ESP32 å’Œ M5StickC Plus çš„æ™ºèƒ½ç©ºè°ƒæ§åˆ¶ç³»ç»Ÿï¼Œæ”¯æŒ MQTT è¿œç¨‹æ§åˆ¶å’Œæœ¬åœ°è§¦æ‘¸å±æ“ä½œã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸ“± 3.5å¯¸è§¦æ‘¸å±ç•Œé¢
- ğŸŒ¡ï¸ æ¸©åº¦æ§åˆ¶ (16-30Â°C)
- ğŸ’¡ ç”µæºå¼€å…³æ§åˆ¶
- ğŸ“¡ MQTT è¿œç¨‹æ§åˆ¶
- ğŸ“¶ æ™ºèƒ½Wi-Fié€‰æ‹©ï¼ˆè‡ªåŠ¨è¿æ¥ä¿¡å·æœ€å¼ºçš„ç½‘ç»œï¼‰
- ğŸ”„ è‡ªåŠ¨é‡è¿å’Œé‡å¯æœºåˆ¶
- ğŸ¯ çº¢å¤–å‘å°„ç²¾ç¡®æ§åˆ¶
- ğŸ“Š æ¸©åº¦å»¶è¿Ÿå‘é€åŠŸèƒ½
- ğŸ” è°ƒè¯•æ¨¡å¼æ”¯æŒ
- ğŸ”‹ é•¿æŒ‰é‡å¯åŠŸèƒ½

## ç¡¬ä»¶è¦æ±‚

- ESP32 å¼€å‘æ¿ï¼ˆå¸¦è§¦æ‘¸å±ï¼‰
- M5StickC Plus
- çº¢å¤–å‘å°„æ¨¡å—
- çº¢å¤–æ¥æ”¶æ¨¡å—ï¼ˆç”¨äºå­¦ä¹ é¥æ§å™¨ç¼–ç ï¼‰

## è½¯ä»¶ä¾èµ–

- Arduino IDE 1.8.13+
- ESP32 Arduino æ ¸å¿ƒåº“
- M5StickC Plus åº“
- IRremoteESP8266 åº“
- PubSubClient MQTT å®¢æˆ·ç«¯åº“
- WiFi åº“

## ç›®å½•ç»“æ„

```
.
â”œâ”€â”€ esp32_lvgl/              # ESP32 è§¦æ‘¸å±æ§åˆ¶ç«¯
â”‚   â”œâ”€â”€ main.py             # ä¸»ç¨‹åº
â”‚   â”œâ”€â”€ ili9XXX.py         # æ˜¾ç¤ºå±é©±åŠ¨
â”‚   â””â”€â”€ ft6x36.py          # è§¦æ‘¸å±é©±åŠ¨
â”œâ”€â”€ stickc_ac_con/          # M5StickC Plus çº¢å¤–å‘å°„ç«¯
â”‚   â”œâ”€â”€ stickc_ac_con.ino  # Arduino ä¸»ç¨‹åº
â”‚   â””â”€â”€ README.md          # é¡¹ç›®è¯´æ˜
â””â”€â”€ ir_receiver/            # çº¢å¤–ä¿¡å·æ¥æ”¶å™¨
    â””â”€â”€ README.md          # æ¥æ”¶å™¨è¯´æ˜
```

## æ–°å¢åŠŸèƒ½è¯´æ˜

### æ™ºèƒ½Wi-Fié€‰æ‹©
- å¼€æœºè‡ªåŠ¨æ‰«æå¯ç”¨ç½‘ç»œ
- æ£€æµ‹ "office" å’Œ "office_2.4" çš„ä¿¡å·å¼ºåº¦
- è‡ªåŠ¨è¿æ¥ä¿¡å·æœ€å¼ºçš„ç½‘ç»œ
- å¦‚æœè¿æ¥å¤±è´¥ï¼Œä¼šå°è¯•è¿æ¥å¦ä¸€ä¸ªç½‘ç»œ

### æ¸©åº¦å»¶è¿Ÿå‘é€
- æŒ‰ä¸‹æŒ‰é’®Bå¢åŠ æ¸©åº¦è®¾ç½®
- å±å¹•å®æ—¶æ˜¾ç¤ºå°†è¦è®¾ç½®çš„æ¸©åº¦
- æŒ‰é”®æ“ä½œåç­‰å¾…1ç§’
- è‹¥1ç§’å†…æ— æ–°æ“ä½œï¼Œå‘é€è®¾ç½®å‘½ä»¤
- é¿å…é¢‘ç¹å‘é€æŒ‡ä»¤ï¼Œæé«˜ç”¨æˆ·ä½“éªŒ

### è°ƒè¯•æ¨¡å¼
- é»˜è®¤å¼€å¯ï¼Œå¯åœ¨ä»£ç ä¸­ä¿®æ”¹
- è¿æ¥ä¸²å£åï¼Œæ‰€æœ‰æ“ä½œä¼šè¾“å‡ºåˆ°ä¸²å£
- åŒ…æ‹¬MQTTæ¶ˆæ¯ã€çº¢å¤–æŒ‡ä»¤ã€é”™è¯¯ä¿¡æ¯ç­‰
- æ³¢ç‰¹ç‡ä¸º115200
- ä¾¿äºé—®é¢˜æ’æŸ¥å’Œå¼€å‘è°ƒè¯•

### é•¿æŒ‰é‡å¯
- é•¿æŒ‰æŒ‰é’®A 2ç§’ä»¥ä¸Šä¼šé‡å¯è®¾å¤‡
- çŸ­æŒ‰æŒ‰é’®A æ­£å¸¸åˆ‡æ¢ç”µæºå¼€å…³
- Wi-Fiè¿æ¥è¶…æ—¶1åˆ†é’Ÿåè‡ªåŠ¨é‡å¯
- æä¾›ç®€å•çš„æ¢å¤æ–¹å¼ï¼Œæ— éœ€é‡æ–°çƒ§å½•

## ä½¿ç”¨è¯´æ˜

1. å¼€æœºåè‡ªåŠ¨è¿æ¥ä¿¡å·æœ€å¼ºçš„WiFiç½‘ç»œ
2. ç­‰å¾…è¿æ¥æˆåŠŸï¼Œæ§ä»¶è‡ªåŠ¨å¯ç”¨
3. æŒ‰é”®æ“ä½œï¼š
   - çŸ­æŒ‰æŒ‰é’®Aï¼šåˆ‡æ¢ç©ºè°ƒå¼€å…³
   - é•¿æŒ‰æŒ‰é’®A (2ç§’ä»¥ä¸Š)ï¼šé‡å¯è®¾å¤‡
   - æŒ‰é’®Bï¼šå¢åŠ æ¸©åº¦ï¼Œ1ç§’åå‘é€å‘½ä»¤
4. æ¸©åº¦æ§åˆ¶ï¼š
   - æŒ‰ä¸‹æŒ‰é’®Bå¢åŠ æ¸©åº¦(16-30Â°Cå¾ªç¯)
   - å±å¹•å®æ—¶æ˜¾ç¤º"Set to: XXÂ°C"
   - 1ç§’åå‘é€åˆ°ç©ºè°ƒ
5. MQTTçŠ¶æ€åé¦ˆï¼š
   - æ¯æ¬¡æ“ä½œåéƒ½ä¼šå‘é€å½“å‰çŠ¶æ€
   - ä¸Šç”µåè‡ªåŠ¨å‘é€ä¸Šçº¿æ¶ˆæ¯
   - è°ƒè¯•æ¨¡å¼ä¸‹ä¸²å£ä¼šæ˜¾ç¤ºæ‰€æœ‰æ¶ˆæ¯

## API æŒ‡ä»¤é›†ä½¿ç”¨è¯´æ˜

### MQTT ä¸»é¢˜
- æ§åˆ¶æŒ‡ä»¤å‘é€åˆ°: `stickc/aircon`
- çŠ¶æ€åé¦ˆæ¥æ”¶è‡ª: `stickc/up`

### æ§åˆ¶æŒ‡ä»¤
| æŒ‡ä»¤ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `api/power/on` | å¼€æœº | `mosquitto_pub -t stickc/aircon -m "api/power/on"` |
| `api/power/off` | å…³æœº | `mosquitto_pub -t stickc/aircon -m "api/power/off"` |
| `api/temp/XX` | è®¾ç½®æ¸©åº¦(16-30) | `mosquitto_pub -t stickc/aircon -m "api/temp/25"` |
| `api/status` | æŸ¥è¯¢å½“å‰çŠ¶æ€ | `mosquitto_pub -t stickc/aircon -m "api/status"` |

### çŠ¶æ€åé¦ˆ
è®¾å¤‡ä¼šé€šè¿‡ `stickc/up` ä¸»é¢˜å‘é€ JSON æ ¼å¼çš„çŠ¶æ€ä¿¡æ¯ï¼š

1. è®¾å¤‡ä¸Šçº¿æ¶ˆæ¯:
```json
{"device":"stickc","status":"online"}
```

2. çŠ¶æ€æ›´æ–°æ¶ˆæ¯:
```json
{"status":"on","temp":25}
```
æˆ–
```json
{"status":"off","temp":25}
```

### è°ƒè¯•æ¨¡å¼ä½¿ç”¨
1. ç¡®ä¿ `debugMode` å˜é‡è®¾ç½®ä¸º `true`
2. é€šè¿‡ USB è¿æ¥åˆ°ç”µè„‘
3. æ‰“å¼€ä¸²å£ç›‘è§†å™¨ï¼Œè®¾ç½®æ³¢ç‰¹ç‡ä¸º 115200
4. æ‰€æœ‰æ“ä½œéƒ½ä¼šè¾“å‡ºåˆ°ä¸²å£ç›‘è§†å™¨

## æ•…éšœæ’é™¤

1. è®¾å¤‡æ— å“åº”
   - é•¿æŒ‰æŒ‰é’®A 2ç§’ä»¥ä¸Šé‡å¯è®¾å¤‡
   - æ£€æŸ¥ç”µæºè¿æ¥

2. WiFi è¿æ¥é—®é¢˜
   - æ£€æŸ¥ SSID å’Œå¯†ç æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤ä¸¤ä¸ªWi-Fiç½‘ç»œè‡³å°‘æœ‰ä¸€ä¸ªå¯ç”¨
   - è‹¥è¶…è¿‡1åˆ†é’Ÿæœªè¿æ¥ï¼Œè®¾å¤‡ä¼šè‡ªåŠ¨é‡å¯

3. MQTT è¿æ¥é—®é¢˜
   - éªŒè¯æœåŠ¡å™¨åœ°å€å’Œç«¯å£
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - æŸ¥çœ‹ä¸²å£è°ƒè¯•ä¿¡æ¯

4. æ¸©åº¦æ§åˆ¶é—®é¢˜
   - ç¡®è®¤çº¢å¤–å‘å°„å™¨ä½ç½®æ­£ç¡®
   - æ£€æŸ¥ç©ºè°ƒæ¥æ”¶å™¨æ˜¯å¦æœ‰é®æŒ¡
   - é€šè¿‡ä¸²å£æŸ¥çœ‹å‘é€çš„å‘½ä»¤ç»†èŠ‚

## è®¸å¯è¯

MIT License

## è”ç³»æ–¹å¼

- GitHubï¼šhttps://github.com/topaz1874/ac-controller

### åˆ†æ”¯è¯´æ˜

- `main`: ç¨³å®šå‘å¸ƒç‰ˆæœ¬
- `develop`: æ—¥å¸¸å¼€å‘åˆ†æ”¯
- `feature/*`: æ–°åŠŸèƒ½å¼€å‘
- `hotfix/*`: ç´§æ€¥é—®é¢˜ä¿®å¤

### å¼€å‘å·¥ä½œæµ

1. å…‹éš†ä»“åº“

## å®‰è£…è¯´æ˜

1. ESP32 è§¦æ‘¸å±æ§åˆ¶ç«¯
- ä½¿ç”¨ esptool å’Œ adafruit-ampy å·¥å…·åˆ·å…¥ MicroPython
- ä¸Šä¼  esp32_lvgl/main.py, esp32_lvgl/ili9XXX.py, esp32_lvgl/ft6x36.py åˆ° ESP32

2. M5StickC Plus çº¢å¤–å‘å°„ç«¯
- ä½¿ç”¨ Arduino IDE æ‰“å¼€ `stickc_ac_con.ino`
- é€‰æ‹©å¼€å‘æ¿ä¸º "M5Stick-C"
- ç¼–è¯‘å¹¶ä¸Šä¼ 

## é…ç½®è¯´æ˜

1. WiFi è®¾ç½®ï¼ˆesp32_lvgl/main.pyï¼‰

## API æŒ‡ä»¤é›†ä½¿ç”¨è¯´æ˜

### MQTT ä¸»é¢˜
- æ§åˆ¶æŒ‡ä»¤å‘é€åˆ°: `stickc/aircon`
- çŠ¶æ€åé¦ˆæ¥æ”¶è‡ª: `stickc/up`

### æ§åˆ¶æŒ‡ä»¤
| æŒ‡ä»¤ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `api/power/on` | å¼€æœº | `mosquitto_pub -t stickc/aircon -m "api/power/on"` |
| `api/power/off` | å…³æœº | `mosquitto_pub -t stickc/aircon -m "api/power/off"` |
| `api/temp/XX` | è®¾ç½®æ¸©åº¦(16-30) | `mosquitto_pub -t stickc/aircon -m "api/temp/25"` |
| `api/status` | æŸ¥è¯¢å½“å‰çŠ¶æ€ | `mosquitto_pub -t stickc/aircon -m "api/status"` |

### çŠ¶æ€åé¦ˆ
è®¾å¤‡ä¼šé€šè¿‡ `stickc/up` ä¸»é¢˜å‘é€ JSON æ ¼å¼çš„çŠ¶æ€ä¿¡æ¯ï¼š

1. è®¾å¤‡ä¸Šçº¿æ¶ˆæ¯:
```json
{"device":"stickc","status":"online"}
```

2. çŠ¶æ€æ›´æ–°æ¶ˆæ¯:
```json
{"status":"on","temp":25}
```
æˆ–
```json
{"status":"off","temp":25}
```

### ç½‘é¡µé›†æˆç¤ºä¾‹
```javascript
// è¿æ¥MQTTæœåŠ¡å™¨
const client = mqtt.connect('ws://your-mqtt-broker:9001');

// è®¢é˜…çŠ¶æ€åé¦ˆä¸»é¢˜
client.subscribe('stickc/up');

// ç›‘å¬çŠ¶æ€æ›´æ–°
client.on('message', (topic, message) => {
  if (topic === 'stickc/up') {
    const status = JSON.parse(message.toString());
    updateUI(status);
  }
});

// å‘é€æ§åˆ¶å‘½ä»¤
function powerOn() {
  client.publish('stickc/aircon', 'api/power/on');
}

function powerOff() {
  client.publish('stickc/aircon', 'api/power/off');
}

function setTemperature(temp) {
  client.publish('stickc/aircon', `api/temp/${temp}`);
}

function queryStatus() {
  client.publish('stickc/aircon', 'api/status');
}
```
```

ä¸»è¦æ”¹è¿›ï¼š

1. ä½¿ç”¨å¸¸é‡å®šä¹‰ API æŒ‡ä»¤ï¼Œä¾¿äºç»´æŠ¤å’Œä¿®æ”¹
2. ä¸ºæ¯ä¸ª API æŒ‡ä»¤æ·»åŠ è¯¦ç»†æ³¨é‡Š
3. æ·»åŠ äº† README éƒ¨åˆ†ï¼Œè¯¦ç»†è¯´æ˜ API ä½¿ç”¨æ–¹æ³•
4. æä¾›äº† MQTT å‘½ä»¤è¡Œç¤ºä¾‹
5. æä¾›äº†ç½‘é¡µé›†æˆç¤ºä¾‹ä»£ç 
6. è¯¦ç»†è¯´æ˜äº† JSON æ ¼å¼çš„çŠ¶æ€åé¦ˆ

è¿™æ ·çš„æ–‡æ¡£å’Œä»£ç æ³¨é‡Šä½¿å¾— API æ›´æ˜“äºç†è§£å’Œä½¿ç”¨ï¼Œç‰¹åˆ«æ˜¯å¯¹äºç½‘é¡µå¼€å‘è€…æ¥è¯´ã€‚
